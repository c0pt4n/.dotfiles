#!/bin/sh

dir="$(xdg-user-dir PICTURES)/screenshots"
ocr_cmd="wl-copy"
sel="${1:-$(printf "select\nfullscreen\nselect-copy\nfullscreen-copy\nselected image to text" | menu -p "$(basename "$0")> ")}" || exit 1
out="$dir/$(date "+%Y%m%d-%H%M%S").png"

case "$sel" in
	select)
		g="$(slurp -d)" || exit 1
		grim -g "$g" "$out"
		notify-send -a "$(basename "$0")" "screenshot" "saved to $out"
		;;
	fullscreen)
		grim "$out"
		notify-send -a "$(basename "$0")" "screenshot" "saved to $out"
		;;
    select-copy)
		g="$(slurp -d)" || exit 1
		grim -g "$g" - | wl-copy -t image/png
		notify-send -a "$(basename "$0")" "screenshot" "saved to clipboard"
		;;
    fullscreen-copy)
		grim - | wl-copy -t image/png
		notify-send -a "$(basename "$0")" "screenshot" "saved to clipboard"
		;;
    "selected image to text")
		g="$(slurp -d)" || exit 1
		tmpfile=$(mktemp /tmp/ocr-XXXXXX.png) && grim -g "$g" - > "$tmpfile" && tesseract "$tmpfile" - -l eng | ${ocr_cmd} && rm "$tmpfile"
		;;
esac
